# 開発サーバー起動エラー解決手順

## エラー: ERR_CONNECTION_REFUSED

### 原因

ログを確認した結果、以下の問題が判明しました：

1. **`vite`コマンドが見つからない**
   - `node_modules`がインストールされていない
   - 依存関係が不完全

2. **パスの問題**
   - 日本語文字を含むパスでPowerShellが正しく動作しない場合がある

3. **ポートの競合**
   - ポート5174が既に使用されている

## 解決方法

### 方法1: 改善されたスクリプトを使用（推奨）

**確実版スクリプトを使用：**

```powershell
.\開発サーバー起動_確実版.ps1
```

または

```cmd
開発サーバー起動_確実版.bat
```

このスクリプトは以下を自動的に実行します：
- Node.js/npmの確認
- 依存関係の確認とインストール
- ポートの確認
- サーバーの起動
- 起動確認とブラウザの自動起動

### 方法2: 手動で依存関係をインストール

```powershell
# プロジェクトディレクトリに移動
cd "プロジェクトのパス"

# 依存関係をインストール
npm install

# サーバーを起動
npm run dev
```

### 方法3: 既存のプロセスを確認・終了

```powershell
# ポート5174を使用しているプロセスを確認
netstat -ano | findstr :5174

# プロセスを終了（PIDを確認してから）
taskkill /PID <PID番号> /F
```

## 改善内容

### start-local.ps1 の改善点

1. **依存関係の自動確認とインストール**
   - `node_modules`が存在しない場合、自動的に`npm install`を実行

2. **エラーハンドリングの強化**
   - 各ステップでエラーを確認
   - わかりやすいエラーメッセージを表示

3. **ログの改善**
   - 起動プロセスを詳細に表示
   - 問題発生時にログを確認しやすく

### 新規作成: 開発サーバー起動_確実版.ps1

より確実にサーバーを起動するためのスクリプト：

- **5段階のチェック**
  1. Node.jsの確認
  2. 依存関係の確認とインストール
  3. ポートの確認
  4. サーバーの起動
  5. 起動確認

- **詳細なログ出力**
  - 各ステップの進行状況を表示
  - エラー時に具体的な対処法を提示

- **自動ブラウザ起動**
  - サーバー起動後に自動的にブラウザを開く

## 今後の対策

### 1. 依存関係の確認を自動化

起動スクリプトが自動的に`npm install`を実行するように改善済み

### 2. エラーメッセージの改善

わかりやすいエラーメッセージと対処法を表示

### 3. ログの保存

起動ログを`資料\ログ\dev-server.log`に保存

### 4. ポート競合の検出

既存のプロセスを検出して適切に対処

## テスト手順

1. **依存関係を削除してテスト**
   ```powershell
   Remove-Item -Recurse -Force node_modules
   .\開発サーバー起動_確実版.ps1
   ```
   → 自動的に`npm install`が実行されることを確認

2. **ポートが使用されている場合のテスト**
   - 別のターミナルで`npm run dev`を実行
   - スクリプトを実行
   → 既存のサーバーを使用することを確認

3. **正常起動のテスト**
   - クリーンな状態でスクリプトを実行
   → サーバーが正常に起動し、ブラウザが開くことを確認

## 注意事項

- Node.js 20以上23未満が必要です
- 初回起動時は`npm install`に時間がかかります
- ファイアウォールがブロックしている場合は許可してください
